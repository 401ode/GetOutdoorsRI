function getJSON(t,e){var i;i="/"!==t.charAt(0)&&"XDomainRequest"in window&&null!==window.XDomainRequest&&!/MSIE 1\d\./.test(navigator.appVersion)?new XDomainRequest:new XMLHttpRequest,i.open("GET",t,!0),i.onload=function(){try{data=JSON.parse(i.responseText)}catch(t){return}e(null,data),i.onload=i.onerror=i.onprogress=null},i.onerror=function(){e("something failed")},i.onprogress=function(){},i.send()}function updateAPIKey(t){if(store.api_key=api_key=t,$('[name="a-pikey"]').val(t),"demo"!==t){var e=document.querySelector(".login");e&&e.parentNode.removeChild(e)}getJSON("https://api3.gosquared.com/account/v1/sites?api_key="+t+"&appName=labs_display",function(t,e){var i=e.owned.concat(e.shared).sort(function(t,e){return t.id-e.id});selectSite(i[0]),$(".sitelist").empty(),i.forEach(function(t){var e=$("<li>");e.text(t.name),e.on("click",function(){selectSite(t),$(".sitelist .selected").removeClass("selected"),e.addClass("selected")}),e.toggleClass("selected",selectedSite.site_token===t.site_token),e.appendTo(".sitelist")})})}function selectSite(t){selectedSite=t,siteName.text(t.name),setSite(t)}function formatNumber(t){t+="";for(var e=t.split("."),i=e[0],n=e.length>1?"."+e[1]:"",a=/(\d+)(\d{3})/;a.test(i);)i=i.replace(a,"$1,$2");return i+n}function _sb(){$(".sitelist").css({bottom:$(".btm").outerHeight()})}function nextFrame(t){nextFrameCallbacks.push(t)}function animate(t,e,i,n,a){var s,r=window.performance&&performance.now?function(){return performance.now()}:function(){return Date.now()},o=r();return function h(){if(!s){var d=r(),l=(d-o)/i;l=Math.min(1,l),n(a(l)*(e-t)+t,i),1>l&&nextFrame(h)}}(),{cancel:function(){s=!0}}}function setSite(t){var e=t.site_token,i=id=Math.random();!function n(){i===id&&getJSON("https://api3.gosquared.com/now/v3/overview?api_key="+api_key+"&site_token="+e+"&appName=labs_display",function(t,e){i===id&&(meter.value=e.visitors,meter.min=e.summary.min,meter.max=e.summary.max,setTimeout(n,3e3))})}()}var store=window.localStorage||{},api_key=store.api_key||"demo",W=300,H=250,transform=["transform","webkitTransform","mozTransform","msTransform"].filter(function(t){return t in document.createElement("a").style})[0],sidebar=$(['<div class="sidebar">',"<form>",'<label for="a-pikey">API Key</label>','<input name="a-pikey" placeholder="Enter API Key&hellip;">',"</form>","<h4>Sites</h4>",'<ul class="sitelist"></ul>','<div class="btm">',"<h4>More info</h4>","<p>Display is a GoSquared Labs project. It is experimental, and therefore may not be as stable as the core GoSquared apps and services.</p>",'<p><a href="/labs">Learn more about GoSquared Labs</a></p>',"</div>","</div>"].join("")).appendTo("body");_sb(),$(window).on("resize",_sb),sidebar.find("form").on("submit",function(t){return updateAPIKey(sidebar.find("input").val()),t.preventDefault(),!1});var CONTAINER=$('<div class="container">').appendTo("body"),siteName=$('<a class="site-name">Site Name</a>').appendTo(CONTAINER).on("click",function(){CONTAINER.toggleClass("foo")}),overlay=$('<div class="overlay">').appendTo(CONTAINER).on("click",function(){CONTAINER.removeClass("foo")});updateAPIKey(api_key),api_key&&"demo"!==api_key||getJSON("/admin/getAPIKey",function(t,e){e&&e.api_key&&updateAPIKey(e.api_key)});var logo=$("<a>").attr("href","/").addClass("logo").append($("<img>").attr("src","//static.gosquared.com/images/labs/display/logo_gosquared_"+(page.lightLogo?"white":"dark")+"_01"+((window.devicePixelRatio||window.webkitDevicePixelRatio||1)>1.5?"@2x":"")+".png").css({width:220})).appendTo(CONTAINER),nextFrameCallbacks=[];!function t(){var e=nextFrameCallbacks;nextFrameCallbacks=[],e.forEach(function(t){t()}),window.requestAnimationFrame?requestAnimationFrame(t):setTimeout(t,1e3/60)}();var Bezier=function(){"use strict";var t=400,e=function(t){return 1/(200*t)},i=function(i,n,a,s){var r=3*i,o=3*(a-i)-r,h=1-r-o,d=3*n,l=3*(s-n)-d,c=1-d-l,u=function(t){return((h*t+o)*t+r)*t},m=function(t){return((c*t+l)*t+d)*t},f=function(t){return(3*h*t+2*o)*t+r},p=function(t,e){var i,n,a,s,r,o;for(a=t,o=0;8>o;o++){if(s=u(a)-t,Math.abs(s)<e)return a;if(r=f(a),Math.abs(r)<1e-6)break;a-=s/r}if(i=0,n=1,a=t,i>a)return i;if(a>n)return n;for(;n>i;){if(s=u(a),Math.abs(s-t)<e)return a;t>s?i=a:n=a,a=.5*(n-i)+i}return a},w=function(t,e){return m(p(t,e))};return function(i,n){return w(i,e(+n||t))}};return{linear:i(0,0,1,1),ease:i(.25,.1,.25,1),easeIn:i(.42,0,1,1),easeOut:i(0,0,.58,1),easeInOut:i(.42,0,.58,1),cubicBezier:function(t,e,n,a){return i(t,e,n,a)}}}(),RoundMeter=function(t){t=t||{};var e=t.width||200,i=t.height||200,n=t.min||0,a=t.max||1;this.format=t.format||function(t){return t},this.el=$(['<div class="round-meter">','<div class="meter"></div>','<span class="bignum"></span>','<div class="littlenums">','<div class="min">','<span class="value">',this.format(n),"</span>",'<span class="label">7-day min</span>',"</div>",'<div class="max">','<span class="value">',this.format(a),"</span>",'<span class="label">7-day max</span>',"</div>","</div>","</div>"].join("")),this.el.css({width:e,height:i});var s=this._dpr=window.webkitDevicePixelRatio||window.devicePixelRatio||1;this._w=e*s,this._h=i*s,this._min=n,this._max=a,this._value=0;var r=this.canvas=document.createElement("canvas");r.width=this._w,r.height=this._h,$(r).css({width:e,height:i}),this.ctx=r.getContext("2d"),this.el.find(".meter")[0].appendChild(r),this.el.css({fontSize:(0|this.radius/2.5/this._dpr)+"px"}),this.el.find(".littlenums").css({width:2*(0|this.radius),height:2*(0|this.radius)}),this.el.find(".bignum").css({width:2*(0|this.radius)}),this.drawForeground(),this.draw()};RoundMeter.prototype={constructor:RoundMeter,resize:function(t,e){this._w=t*this._dpr,this._h=e*this._dpr,this.canvas.width=this._w,this.canvas.height=this._h,this.el.css({width:t,height:e}),$(this.canvas).css({width:t,height:e}),this.el.css({fontSize:(0|this.radius/2.5/this._dpr)+"px"}),this.el.find(".littlenums").css({width:2*(0|this.radius),height:2*(0|this.radius)}),this.el.find(".bignum").css({width:2*(0|this.radius)}),this.drawForeground(),this.draw()},get lineWidth(){return this.radius/5},get radius(){return Math.min(this._w,this._h)/2.5},xy:function(t,e){return[this._w/2-t*Math.sin(e),this._h/2+t*Math.cos(e)]},drawWedge:function(t,e){e.beginPath(),e.arc(this._w/2,this._h/2,this.radius,.75*Math.PI,Math.PI*(.75+1.5*t),!1),e.arc(this._w/2,this._h/2,this.radius-this.lineWidth,Math.PI*(.75+1.5*t),.75*Math.PI,!0),e.fill()},drawForeground:function(){var t=document.createElement("canvas");t.width=this._w,t.height=this._h;var e=t.getContext("2d");e.beginPath();for(var i=150,n=0;i>n;n+=1){e.moveTo(this._w/2,this._h/2);var a=this.xy(2*this.radius,Math.PI*(.25+1.5*n/i));e.lineTo(a[0],a[1])}e.lineWidth=1.3*this._dpr*this.radius/200,e.strokeStyle="#000",e.stroke(),e.globalCompositeOperation="source-out",e.fillStyle="#000",this.drawWedge(1,e),this._fg=t},get value(){return this._value},set value(t){this._anim&&this._anim.cancel(),this._anim=animate(this._value,t,250,this.drawValue.bind(this),Bezier.ease),this._value=t},set min(t){this._min=t,this.el.find(".littlenums .min .value").text(this.format(t))},set max(t){this._max=t,this.el.find(".littlenums .max .value").text(this.format(t))},draw:function(){this._anim&&this._anim.cancel(),this.drawValue(this.value)},drawValue:function(t){{var e=Date.now();this._then||e}this._then=e,this.el.find(".bignum").text(this.format(Math.round(t)));var i=this.ctx;i.globalCompositeOperation="source-over",i.fillStyle="#DCECF7",i.fillRect(0,0,this._w,this._h),i.fillStyle="#0095FF",i.beginPath(),i.moveTo(this._w/2,this._h/2),i.arc(this._w/2,this._h/2,2*this.radius,.5*Math.PI,Math.PI*(.75+1.5*(t-this._min)/(this._max-this._min)),!1),i.fill(),i.globalCompositeOperation="destination-in",i.drawImage(this._fg,0,0,this._w,this._h)}},$(function(){var t=window.meter=new RoundMeter({width:window.innerWidth,height:window.innerHeight,min:0,max:1e3,format:formatNumber});t.el.appendTo(CONTAINER),$(window).on("resize",function(){t.resize(window.innerWidth,window.innerHeight)})});var id=Math.random();